---
title: "Assignment – Working with XML and JSON in R"
author: "Thomas Hill"
date: "3/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Instructions
Pick three of your favorite books on one of your favorite subjects. At least one of the books should have more than one author. For each book, include the title, authors, and two or three other attributes that you find interesting.

Take the information that you’ve selected about these three books, and separately create three files which store the book’s information in HTML (using an html table), XML, and JSON formats (e.g. “books.html”, “books.xml”, and “books.json”). To help you better understand the different file structures, I’d prefer that you create each of these files “by hand” unless you’re already very comfortable with the file formats.

Write R code, using your packages of choice, to load the information from each of the three sources into separate R data frames. Are the three data frames identical?

Your deliverable is the three source files and the R code. If you can, package your assignment solution up into an .Rmd file and publish to rpubs.com. [This will also require finding a way to make your three text files accessible from the web].


# HTML

```{r HTML-text}
library(rvest)

  html_txt <- "https://raw.githubusercontent.com/hillt5/DATA607_assignment_3_15_20/master/html_txt"

```

# Convert to Data Frame


```{r HTML-convert}

html_df <- as.data.frame(html_table(read_html(html_txt)))
html_df

```

Of note, the break I used in the example with two authors did not carry over and instead added a '\\n' instead of the break. I also used an unusual character in the second book to see if this was converted, and it was not.


```{r HTML-replace}
library(stringr)
html_authors <- str_replace(html_df[1,2], "\\r\\n", "" )
html_df[1,2] <- html_authors
html_accent <- str_replace(html_df[2,1], "Ã©", "e")
html_df[2,1] <- html_accent
html_df
```
# XML

```{r XML-txt}

library(XML)
xml_txt <- "C:/Users/Thomas/Documents/GitHub/DATA607_assignment_3_15_20/xml_txt"
		
```


I was unable to read the url for the xml file directly from GitHub. This is available for download on my repository for this homework.

```{r XML-convert}
xml_df <- xmlToDataFrame(xml_txt,homogeneous = TRUE, stringsAsFactors = FALSE)
xml_df
```
Using xmlToDataFrame, I keep throwing the same error about the duplicate authors.  The only way I avoid this error is to use the argument homogenous = TRUE, which creates another issue: the second author shifts the rest of the columns for this particular book.

```{r xml-convert-2}
xml_two_authors <- paste(xml_df[[1,2]], as.character(","), xml_df[[1,3]])
xml_df[[1,2]] <- xml_two_authors
xml_df[[1,3]] <- xml_df[[1,4]]
xml_df[[1,4]] <- xml_df[[1,5]]
xml_df <- xml_df[-5]
xml_df
```

I ended up using manipulations of the data frame cells to generate the appropriate columns. I pasted the two author cells together, then shifted the contents of the other cells in the affectd row left one column, and finally deleted the rightmost row.  There are undoubtedly other solutions to this that would scale better in terms of using identifying XML nodes and XPath commands.


```{r JSON-text}

json_txt <- "https://raw.githubusercontent.com/hillt5/DATA607_assignment_3_15_20/master/json_txt"

```


```{r JSON-convert}
library(rjson)
json_df <- as.data.frame(fromJSON(file = json_txt))
json_df
```
My first thought was to import using a rjson function, hoever the data frame did not have its intended effect. The two rows are double entries of the book with two authors. Additionally, the two other books are added as extra columns at the end of the two author rows. To figure out the problem, I'll start by looking at the list originally generated by fromJSON.   


```{r JSON-convert-2}
json_list <- fromJSON(file = json_txt)
authors_json <- paste(json_list[[1]][[2]][[1]], ",", json_list[[1]][[2]][[2]])
json_list[[1]][[2]] <- authors_json
json_df2 <- as.data.frame(json_list)
json_df2
```
This manipulation corrected the authors, but it also appears that there is something wrong with the structure of the data that is generating a single row with the other two books appended. I'll try to fix this with the rbind function.

```{r JSON-covert-3}
json_book1 <- json_df2[1:4]
json_book2 <- json_df2[5:8]
names(json_book2) <- names(json_book1)
json_book3 <- json_df2[9:12]
names(json_book3) <- names(json_book1)
json_df3 <- rbind(json_book1, json_book2, json_book3)
json_df3
```
After renaming the names of the second two books, I was able to rbind the three books together into a single data frame.
